<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Finance Calculator</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://unpkg.com/aos@2.3.4/dist/aos.css" rel="stylesheet">
  <script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fadeIn { animation: fadeIn 0.8s ease forwards; }
    .animate-slideUp { animation: slideUp 1s ease forwards; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen">
  <div class="max-w-5xl mx-auto px-6">
    <!-- Header -->
    <div class="text-center mb-6">
      <p class="mt-20"></p>
      <h1 class="text-2xl font-bold">Personal Financial Calculator</h1>
      <p class="text-sm text-gray-500 mt-1">Breakdown your income, expenses, assets & liabilities</p>
    </div>
    <div class="space-y-10">
      <!-- Income Card -->
      <div data-aos="fade-up" data-aos-delay="100">
        <div class="rounded-2xl shadow-lg p-8 bg-white/30 backdrop-blur-md border border-white/20">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
            <div>
              <h2 class="text-xl font-semibold text-green-700 mb-2">Monthly Income</h2>
              <p class="text-gray-700 text-sm leading-relaxed mb-6">Income refers to the money you earn regularly, such as your salary, side jobs, 
                or business profits. Keeping track of income helps you plan and budget effectively.
              </p>
              <p class="text-sm font-semibold text-gray-500 mb-5">Net income: Obtained from main job (excluding EPF, Sosco & all mandatory deductions).</p>
              <p class="text-sm font-semibold text-gray-500 mb-5">Other income: e.g rental, commissions, dividends.</p>
            </div>
            <div class="space-y-4">
              <div>
                <label for="salary" class="block text-gray-700 text-sm mb-1">Monthly Salary (RM)</label>
                <input id="salary" type="number" class="w-full p-3 rounded-lg bg-white/60 border focus:ring-2 focus:ring-green-300" placeholder="e.g. 3000">
              </div>
              <div>
                <label for="otherIncome" class="block text-gray-700 text-sm mb-1">Other Income (RM)</label>
                <input id="otherIncome" type="number" class="w-full p-3 rounded-lg bg-white/60 border focus:ring-2 focus:ring-green-300" placeholder="e.g. 500">
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Expenses Card -->
      <div data-aos="fade-up" data-aos-delay="100">
        <div class="rounded-2xl shadow-lg p-8 bg-white/30 backdrop-blur-md border border-white/20">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
            <div>
              <h2 class="text-xl font-semibold text-red-700 mb-2">Monthly Expenses</h2>
              <p class="text-gray-700 text-sm leading-relaxed mb-6">
                Expenses are the costs you pay for living, such as food, rent, and transport. 
                Tracking your expenses shows where your money goes and how to save.
              </p>
              <p class="text-sm font-semibold text-gray-500 mb-5">Total Credit Card Repayment: Total of all credit card monthly repayment.</p>
              <p class="text-sm font-semibold text-gray-500 mb-5">Total Vehicle Loan/Financing Repayment: Total of all vehicle loan monthly repayment (e.g motorcycle, car, etc).</p>
              <p class="text-sm font-semibold text-gray-500 mb-5">Total Property Loan/Financing Repayment: Total of all property loan monthly repayment (e.g house, shoplot, land, etc).</p>
              <p class="text-sm font-semibold text-gray-500 mb-5">Total Personal & Household Expenses: Total expenses for all necessities (e.g groceries, utilities, etc).</p>
              <p class="text-sm font-semibold text-gray-500 mb-5">Total Insurance/Takaful Expenses: Total monthly insurance/takaful paid.</p>
              <p class="text-sm font-semibold text-gray-500 mb-5">Other expenses: Any other expenses not listed above.</p>
            </div>
            <div class="space-y-4">
              <div>
                <label for="creditCardRepayment" class="block text-gray-700 text-sm mb-1">Total Credit Card Repayments (RM)</label>
                <input id="creditCardRepayment" type="number" class="w-full p-3 rounded-lg bg-white/60 border focus:ring-2 focus:ring-red-300" placeholder="e.g. 800">
              </div>
              <div>
                <label for="vehicleLoanRepayment" class="block text-gray-700 text-sm mb-1">Total Vehicle Loan/Financing Repayment (RM)</label>
                <input id="vehicleLoanRepayment" type="number" class="w-full p-3 rounded-lg bg-white/60 border focus:ring-2 focus:ring-red-300" placeholder="e.g. 300">
              </div>
              <div>
                <label for="propertyLoanRepayment" class="block text-gray-700 text-sm mb-1">Total Property Loan/Financing Repayment (RM)</label>
                <input id="propertyLoanRepayment" type="number" class="w-full p-3 rounded-lg bg-white/60 border focus:ring-2 focus:ring-red-300" placeholder="e.g. 1000">
              </div>
              <div>
                <label for="personalHouseholdExpenses" class="block text-gray-700 text-sm mb-1">Total Personal & Household Expenses (RM)</label>
                <input id="personalHouseholdExpenses" type="number" class="w-full p-3 rounded-lg bg-white/60 border focus:ring-2 focus:ring-red-300" placeholder="e.g. 1000">
              </div>
              <div>
                <label for="insuranceExpenses" class="block text-gray-700 text-sm mb-1">Total Insurance/Takaful Expenses (RM)</label>
                <input id="insuranceExpenses" type="number" class="w-full p-3 rounded-lg bg-white/60 border focus:ring-2 focus:ring-red-300" placeholder="e.g. 1000">
              </div>
              <div>
                <label for="otherExpenses" class="block text-gray-700 text-sm mb-1">Total Other Expenses (RM)</label>
                <input id="otherExpenses" type="number" class="w-full p-3 rounded-lg bg-white/60 border focus:ring-2 focus:ring-red-300" placeholder="e.g. 1000">
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Assets Card -->
      <div data-aos="fade-up" data-aos-delay="100">
        <div class="rounded-2xl shadow-lg p-8 bg-white/30 backdrop-blur-md border border-white/20">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
            <div>
              <h2 class="text-xl font-semibold text-blue-700 mb-2">Assets</h2>
              <p class="text-gray-700 text-sm leading-relaxed mb-6">
                Assets are what you own that have value, such as savings, investments, or property. 
                Recording assets helps measure your financial strength.
              </p>
              <p class="text-sm font-semibold text-gray-500 mb-5">Total Savings: Total value of cash savings and its equivalent (e.g Bank Account, Tabung Haji, Fixed Deposit).</p>
              <p class="text-sm font-semibold text-gray-500 mb-5">Total Property Value: Total Total current value of property in holdings (e.g House, shoplot, land, precious metals, valuable items).</p>
              <p class="text-sm font-semibold text-gray-500 mb-5">Total Investment Value: Total current value of investments (e.g ASB, stocks, crypto asset, etc).</p>
              <p class="text-sm font-semibold text-gray-500 mb-5">Total Retirement Fund: Total value of aset designed for retirement (e.g EPF, PRS).</p>
            </div>
            <div class="space-y-4">
              <div>
                <label for="savings" class="block text-gray-700 text-sm mb-1">Total Savings (RM)</label>
                <input id="savings" type="number" class="w-full p-3 rounded-lg bg-white/60 border focus:ring-2 focus:ring-blue-300" placeholder="e.g. 5000">
              </div>
              <div>
                <label for="propertyValue" class="block text-gray-700 text-sm mb-1">Total Property Value (RM)</label>
                <input id="propertyValue" type="number" class="w-full p-3 rounded-lg bg-white/60 border focus:ring-2 focus:ring-blue-300" placeholder="e.g. 2000">
              </div>
              <div>
                <label for="investmentsValue" class="block text-gray-700 text-sm mb-1">Total Investments (RM)</label>
                <input id="investmentsValue" type="number" class="w-full p-3 rounded-lg bg-white/60 border focus:ring-2 focus:ring-blue-300" placeholder="e.g. 2000">
              </div>
              <div>
                <label for="retirementFund" class="block text-gray-700 text-sm mb-1">Total Retirement Fund (RM)</label>
                <input id="retirementFund" type="number" class="w-full p-3 rounded-lg bg-white/60 border focus:ring-2 focus:ring-blue-300" placeholder="e.g. 2000">
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Liabilities Card -->
      <div data-aos="fade-up" data-aos-delay="100">
        <div class="rounded-2xl shadow-lg p-8 bg-white/30 backdrop-blur-md border border-white/20">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
            <div>
              <h2 class="text-xl font-semibold text-purple-700 mb-2">Liabilities</h2>
              <p class="text-gray-700 text-sm leading-relaxed mb-6">
                Liabilities are debts or obligations you owe, like loans or credit card balances. 
                Understanding liabilities helps you manage repayment better.
              </p>
              <p class="text-sm font-semibold text-gray-500 mb-5">Total Card Credit Balance: Total remaining balance of all credit card.</p>
              <p class="text-sm font-semibold text-gray-500 mb-5">Total Vehicle Loan/Financing Balance: Total remaining balance of all vehicle loans/financing.</p>
              <p class="text-sm font-semibold text-gray-500 mb-5">Total Property Financing Balance: Total remaining balance of all property financing.</p>
              <p class="text-sm font-semibold text-gray-500 mb-5">Other Loan/Financing Balance: Remaining balance of all any other loans/financing.</p>
            </div>
            <div class="space-y-4">
              <div>
                <label for="creditCardBalance" class="block text-gray-700 text-sm mb-1">Total Card Credit Balance (RM)</label>
                <input id="creditCardBalance" type="number" class="w-full p-3 rounded-lg bg-white/60 border focus:ring-2 focus:ring-purple-300" placeholder="e.g. 15000">
              </div>
              <div>
                <label for="vehicleLoanBalance" class="block text-gray-700 text-sm mb-1">Total Vehicle Loan/Financing Balance (RM)</label>
                <input id="vehicleLoanBalance" type="number" class="w-full p-3 rounded-lg bg-white/60 border focus:ring-2 focus:ring-purple-300" placeholder="e.g. 2000">
              </div>
              <div>
                <label for="propertyFinancingBalance" class="block text-gray-700 text-sm mb-1">Total Property Financing Balance (RM)</label>
                <input id="propertyFinancingBalance" type="number" class="w-full p-3 rounded-lg bg-white/60 border focus:ring-2 focus:ring-purple-300" placeholder="e.g. 2000">
              </div>
              <div>
                <label for="otherLiabilities" class="block text-gray-700 text-sm mb-1">Total Other Loan/Financing Balance (RM)</label>
                <input id="otherLiabilities" type="number" class="w-full p-3 rounded-lg bg-white/60 border focus:ring-2 focus:ring-purple-300" placeholder="e.g. 2000">
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Calculate Button -->
      <div class="mt-6 text-center">
        <button onclick="calculate()" class="bg-indigo-700 text-white px-8 py-3 rounded-xl shadow hover:bg-indigo-800 transition">Calculate</button>
      </div>
      <div class="text-center text-xs text-gray-400 mt-6">
        <p>Tip: Update values, then click Calculate. Values formatted in RM on result card.</p>
      </div>
      <!-- Hidden Results Section -->
      <div id="resultsSection" class="hidden opacity-0 pointer-events-none transition-all duration-700 ease-in-out mt-10">
        <div class="mt-6 grid gap-6 md:grid-cols-3">
          <div class="md:col-span-2">
            <div class="bg-white rounded-2xl shadow p-6">
              <h3 class="text-lg font-semibold mb-4">Summary</h3>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div class="bg-blue-50 rounded-xl p-4">
                  <p class="text-gray-500 text-sm">Income</p>
                  <p class="text-2xl font-bold text-blue-600" id="totalIncome">RM0</p>
                </div>
                <div class="bg-green-50 rounded-xl p-4">
                  <p class="text-gray-500 text-sm">Expenses</p>
                  <p class="text-2xl font-bold text-green-600" id="totalExpenses">RM0</p>
                </div>
                <div class="bg-purple-50 rounded-xl p-4">
                  <p class="text-gray-500 text-sm">Assets</p>
                  <p class="text-2xl font-bold text-purple-600" id="totalAssets">RM0</p>
                </div>
                <div class="bg-yellow-50 rounded-xl p-4">
                  <p class="text-gray-500 text-sm">Liabilities</p>
                  <p class="text-2xl font-bold text-yellow-600" id="totalLiabilities">RM0</p>
                </div>
              </div>
            </div>
          </div>
          <div class="bg-white rounded-2xl shadow p-6 md:col-span-1">
            <h3 class="text-lg font-semibold mb-4">Financial Status</h3>
            <div class="space-y-3 text-sm text-gray-700">
              <div class="flex justify-between">
                <span>Cashflow</span>
                <span id="cashflow">0</span>
              </div>
              <div class="flex justify-between">
                <span>Net Worth</span>
                <span id="networth">0</span>
              </div>
              <div class="flex justify-between">
                <span>Wealth Ratio</span>
                <span id="wealthratio">0</span>
              </div>
            </div>
          </div>
        </div>
        <!-- Ratios + Charts -->
        <div class="mt-12 bg-white rounded-2xl shadow-lg p-8">
          <h3 class="text-xl font-semibold mb-6 text-center">Financial Ratios Overview</h3>
          <div class="flex flex-col md:flex-row justify-around items-center gap-6 text-center">
            <div>
              <h4 class="font-medium text-gray-800">Savings Ratio</h4>
              <p class="text-gray-700 text-sm leading-relaxed mb-6">Benchmark &gt; 10%</p>
              <p id="savingsratio" class="text-2xl font-bold text-indigo-600 mt-2">0%</p>
            </div>
            <div>
              <h4 class="font-medium text-gray-800">Liquidity Ratio</h4>
              <p class="text-gray-700 text-sm leading-relaxed mb-6">Benchmark ≥ 3 Months</p>
              <p id="liquidityratio" class="text-2xl font-bold text-indigo-600 mt-2">0</p>
            </div>
            <div>
              <h4 class="font-medium text-gray-800">Debt Service Ratio</h4>
              <p class="text-gray-700 text-sm leading-relaxed mb-6">Benchmark &lt; 35%</p>
              <p id="debtServiceRatio" class="text-2xl font-bold text-indigo-600 mt-2">0%</p>
            </div>
          </div>
          <div class="mt-10 grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="bg-gray-50 p-4 rounded-xl shadow-sm">
              <h4 class="text-sm font-semibold text-gray-700 mb-3 text-center">Savings Ratio</h4>
              <canvas id="savingsChart" class="w-full h-40"></canvas>
            </div>
            <div class="bg-gray-50 p-4 rounded-xl shadow-sm">
              <h4 class="text-sm font-semibold text-gray-700 mb-3 text-center">Liquidity Ratio</h4>
              <canvas id="liquidityChart" class="w-full h-40"></canvas>
            </div>
            <div class="bg-gray-50 p-4 rounded-xl shadow-sm">
              <h4 class="text-sm font-semibold text-gray-700 mb-3 text-center">Debt Service Ratio</h4>
              <canvas id="debtChart" class="w-full h-40"></canvas>
            </div>
          </div>
        </div>
        <!-- Financial Health -->
        <div class="mt-12 bg-gradient-to-r from-yellow-50 to-yellow-100 rounded-2xl shadow-lg p-4 max-w-3xl mx-auto text-center">
          <h3 class="text-xl font-semibold mb-6 text-yellow-700">Financial Health Overview</h3>
          <p class="text-gray-600 text-sm">Your overall financial well-being score based on ratios and net worth.</p>
          <p id="health" class="text-3xl font-bold text-yellow-600 mt-4">-</p>
          <div class="w-full h-3 bg-gray-200 rounded-xl mx-auto max-w-md mt-3">
            <div id="health-fill" class="h-3 rounded-xl bg-yellow-500 w-0 transition-all duration-700"></div>
          </div>
          <div id="gauge-container" class="mt-10 flex justify-center">
            <canvas id="healthGauge" class="w-full max-w-xs"></canvas>
          </div>
        </div>
        <div class="mt-8 text-center">
          <button onclick="window.location.href='takaful.html'" class="bg-indigo-700 text-white px-8 py-3 rounded-xl shadow hover:bg-indigo-800 transition">
            Proceed to Takaful Calculator
          </button>
        </div>
      </div>
    </div>
  </div>
  <script>
    function formatRM(n) {
  if (!isFinite(n)) return "∞";
  return "RM " + Number(n).toLocaleString("en-MY", { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}
let savingsChartInstance = null;
let liquidityChartInstance = null;
let debtChartInstance = null;
let wealthRatio = 0;

function calculate() {
  const salary = Number(document.getElementById("salary").value) || 0;
  const otherIncome = Number(document.getElementById("otherIncome").value) || 0;
  const creditCardRepayment = Number(document.getElementById("creditCardRepayment").value) || 0;
  const vehicleLoanRepayment = Number(document.getElementById("vehicleLoanRepayment").value) || 0;
  const propertyLoanRepayment = Number(document.getElementById("propertyLoanRepayment").value) || 0;
  const personalHouseholdExpenses = Number(document.getElementById("personalHouseholdExpenses").value) || 0;
  const insuranceExpenses = Number(document.getElementById("insuranceExpenses").value) || 0;
  const otherExpenses = Number(document.getElementById("otherExpenses").value) || 0;
  const savings = Number(document.getElementById("savings").value) || 0;
  const propertyValue = Number(document.getElementById("propertyValue").value) || 0;
  const investmentsValue = Number(document.getElementById("investmentsValue").value) || 0;
  const retirementFund = Number(document.getElementById("retirementFund").value) || 0;
  const creditCardBalance = Number(document.getElementById("creditCardBalance").value) || 0;
  const vehicleLoanBalance = Number(document.getElementById("vehicleLoanBalance").value) || 0;
  const propertyFinancingBalance = Number(document.getElementById("propertyFinancingBalance").value) || 0;
  const otherLiabilities = Number(document.getElementById("otherLiabilities").value) || 0;
  const income = salary + otherIncome;
  const expenses = creditCardRepayment + vehicleLoanRepayment + propertyLoanRepayment + personalHouseholdExpenses + insuranceExpenses + otherExpenses;
  const assets = savings + propertyValue + investmentsValue + retirementFund;
  const liabilities = creditCardBalance + vehicleLoanBalance + propertyFinancingBalance + otherLiabilities;

  document.getElementById("totalIncome").textContent = formatRM(income);
  document.getElementById("totalExpenses").textContent = formatRM(expenses);
  document.getElementById("totalAssets").textContent = formatRM(assets);
  document.getElementById("totalLiabilities").textContent = formatRM(liabilities);

  const cashflowVal = income - expenses;
  const networth = assets - liabilities;
  const currentWealthRatio = expenses === 0 ? Infinity : (networth / expenses);
  const savingsratio = income === 0 ? 0 : ((income - expenses) / income) * 100;
  const liquidityratio = expenses === 0 ? Infinity : (assets / expenses);
  const debtServiceRatio = income === 0 ? 0 : ((creditCardRepayment + vehicleLoanRepayment + propertyLoanRepayment) / income) * 100;

  showResultsSection();

  document.getElementById("cashflow").textContent = formatRM(cashflowVal);
  document.getElementById("networth").textContent = formatRM(networth);
  document.getElementById("wealthratio").textContent = currentWealthRatio === Infinity ? "∞" : currentWealthRatio.toFixed(2);
  document.getElementById("savingsratio").textContent = savingsratio.toFixed(2) + "%";
  document.getElementById("liquidityratio").textContent = liquidityratio === Infinity ? "∞" : liquidityratio.toFixed(2);
  document.getElementById("debtServiceRatio").textContent = debtServiceRatio.toFixed(2) + "%";
  
  const healthScore = Math.min(((savingsratio / 100) * 40 + Math.min(liquidityratio, 10) * 3 + Math.max(0, (100 - debtServiceRatio)) * 0.5), 100);
  document.getElementById("health").textContent = healthScore.toFixed(1) + "%";
  const bar = document.getElementById("health-fill");
  bar.style.transition = "width 0.7s ease-in-out";
  bar.style.width = Math.max(healthScore, 5) + "%";
  wealthRatio = currentWealthRatio === Infinity ? 200 : Math.max(0, Math.min(currentWealthRatio, 200));
  
  updateGaugeFromResult();
  updateRatiosChart(savingsratio, liquidityratio, debtServiceRatio);

  // Save key values for Takaful page (localStorage version)
  localStorage.setItem('totalSalary', totalSalary);
  localStorage.setItem('totalExpenses', totalExpenses);
}
const ctx = document.getElementById('healthGauge').getContext('2d');
const gaugeColors = [
  '#ff0000', '#ff9900', '#cccc00', '#66cc00',
  '#00cc66', '#0099cc', '#9933cc', '#000000'
];
const gaugeLabels = [
  '<1 Bankrupt!', '1-5 Critical', '6-10 Normal', '10-20 Healthy',
  '21-50 Fit', '50-96 Athlete', '>96 Olympic Athlete', '>168 A Free MAN!'
];
const gaugeDataWidths = [1, 5, 5, 10, 30, 46, 72, 72];
const gaugeNeedle = {
  id: 'gaugeNeedle',
  afterDatasetDraw(chart) {
    const { ctx } = chart;
    const meta = chart.getDatasetMeta(0);
    const xCoor = meta.data[0].x;
    const yCoor = meta.data[0].y;
    const outerRadius = meta.data[0].outerRadius;
    const angle = Math.PI + (wealthRatio / 200) * Math.PI;
    const needleRadius = outerRadius * 0.9;
    const needleX = xCoor + needleRadius * Math.cos(angle);
    const needleY = yCoor + needleRadius * Math.sin(angle);
    ctx.save();
    ctx.beginPath();
    ctx.moveTo(xCoor, yCoor);
    ctx.lineTo(needleX, needleY);
    ctx.lineWidth = 3;
    ctx.strokeStyle = 'black';
    ctx.stroke();
    ctx.beginPath();
    ctx.arc(xCoor, yCoor, 5, 0, 2 * Math.PI);
    ctx.fillStyle = 'black';
    ctx.fill();
    ctx.restore();
  }
};
const wealthGauge = new Chart(ctx, {
  type: 'doughnut',
  data: {
    labels: gaugeLabels,
    datasets: [{
      data: gaugeDataWidths,
      backgroundColor: gaugeColors,
      borderWidth: 1,
      borderColor: '#fff'
    }]
  },
  options: {
    rotation: -90,
    circumference: 180,
    cutout: '70%',
    plugins: {
      legend: {
        display: true,
        position: 'bottom'
      }
    }
  },
  plugins: [gaugeNeedle]
});
function updateGaugeFromResult() {
  const ratioText = document.getElementById('wealthratio').innerText;
  let targetValue = parseFloat(ratioText) || 0;
  targetValue = Math.max(0, Math.min(targetValue, 200));
  const start = wealthRatio;
  const end = targetValue;
  let startTime = null;
  const duration = 1200;
  function animateNeedle(timestamp) {
    if (!startTime) startTime = timestamp;
    const progress = Math.min((timestamp - startTime) / duration, 1);
    wealthRatio = start + (end - start) * progress;
    wealthGauge.update('none');
    if (progress < 1) {
      requestAnimationFrame(animateNeedle);
    }
  }
  requestAnimationFrame(animateNeedle);
}
function updateRatiosChart(savingsRatio, liquidityRatio, debtServiceRatio) {
  const savingsBenchmark = 10;
  const liquidityBenchmark = 3;
  const debtBenchmark = 35;

  // Update colors based on benchmarks
  const savingsElem = document.getElementById("savingsratio");
  const liquidityElem = document.getElementById("liquidityratio");
  const debtElem = document.getElementById("debtServiceRatio");

  // --- Savings Ratio: higher is better (>10%)
  savingsElem.style.color = savingsRatio >= savingsBenchmark ? "#16a34a" : "#dc2626"; // green or red

  // --- Liquidity Ratio: higher is better (≥3 months)
  const liquidityValue = liquidityRatio === Infinity ? 200 : liquidityRatio;
  liquidityElem.style.color = liquidityValue >= liquidityBenchmark ? "#16a34a" : "#dc2626";

  // --- Debt Service Ratio: lower is better (<35%)
  debtElem.style.color = debtServiceRatio <= debtBenchmark ? "#16a34a" : "#dc2626";

  // Recreate mini charts (destroy old ones first)
  if (savingsChartInstance) savingsChartInstance.destroy();
  if (liquidityChartInstance) liquidityChartInstance.destroy();
  if (debtChartInstance) debtChartInstance.destroy();

  savingsChartInstance = createMiniChart(
    "savingsChart",
    "Savings",
    Number(savingsRatio.toFixed(2)),
    savingsBenchmark
  );
  liquidityChartInstance = createMiniChart(
    "liquidityChart",
    "Liquidity",
    Number(liquidityValue.toFixed(2)),
    liquidityBenchmark
  );
  debtChartInstance = createMiniChart(
    "debtChart",
    "Debt Service",
    Number(debtServiceRatio.toFixed(2)),
    debtBenchmark
  );
}

function createMiniChart(ctxId, label, userValue, benchmarkValue) {
  const ctx = document.getElementById(ctxId).getContext('2d');
  return new Chart(ctx, {
    type: 'bar',
    data: {
      labels: [label],
      datasets: [
        {
          label: 'Your Result',
          data: [userValue],
          backgroundColor: '#6366f1',
          borderRadius: 6,
        },
        {
          label: 'Benchmark',
          data: [benchmarkValue],
          backgroundColor: '#a5b4fc',
          borderRadius: 6,
        },
      ],
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          display: true,
          position: 'bottom',
          labels: { color: '#4b5563', font: { size: 11 } },
        },
      },
      scales: {
        y: {
          beginAtZero: true,
          grid: { color: '#f3f4f6' },
          ticks: { color: '#6b7280', stepSize: 10 },
        },
        x: {
          grid: { display: false },
          ticks: { color: '#4b5563' },
        },
      },
      animation: { duration: 1000, easing: 'easeOutQuart' },
    },
  });
}
function showResultsSection() {
  const resultsSection = document.getElementById("resultsSection");
  const takafulSection = document.getElementById("takafulButtonSection");
  [resultsSection, takafulSection].forEach(sec => {
    if (sec) {
      sec.classList.remove("hidden", "opacity-0", "pointer-events-none");
      sec.classList.add("opacity-100");
    }
  });
  setTimeout(() => {
    resultsSection.scrollIntoView({ behavior: "smooth", block: "start" });
  }, 400);
}
function toggleInfo(id) {
  const info = document.getElementById(id + "-info");
  const card = info.parentElement;
  info.classList.toggle("show");
  card.classList.toggle("active");
}
AOS.init({ duration: 1000, once: true });

// Show Takaful Section and scroll to it
document.addEventListener('DOMContentLoaded', function () {
  const showTakafulBtn = document.getElementById('showTakafulBtn');
  const takafulSection = document.getElementById('takafulSection');

  if (showTakafulBtn && takafulSection) {
    showTakafulBtn.addEventListener('click', function () {
      // Display the takaful section
      takafulSection.classList.remove('hidden');
      // Animate opacity for fade-in effect
      setTimeout(() => {
        takafulSection.classList.add('opacity-100');
        takafulSection.classList.remove('opacity-0');
        // Scroll into view smoothly
        takafulSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }, 50); // Opacity transition delay
    });
  }
});

// Retrieve stored data on page load
window.addEventListener('DOMContentLoaded', () => {
  const savedSalary = localStorage.getItem('totalSalary');
  const savedExpenses = localStorage.getItem('totalExpenses');

  if (savedSalary && savedExpenses) {
    // Optional: show them on the results section right away
    document.getElementById('resultsSection').classList.remove('hidden', 'opacity-0', 'pointer-events-none');
    document.getElementById('totalIncome').textContent = formatRM(savedSalary);
    document.getElementById('totalExpenses').textContent = formatRM(savedExpenses);
    
    const net = savedSalary - savedExpenses;
    document.getElementById('cashflow').textContent = formatRM(net);

    // If you want, re-save them as baseline for the takaful page
    localStorage.setItem('totalSalary', savedSalary);
    localStorage.setItem('totalExpenses', savedExpenses);
  }
});

  </script>
</body>
</html>